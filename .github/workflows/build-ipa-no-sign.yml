name: Build IPA No Sign

on:
  workflow_dispatch: # Cho phÃ©p cháº¡y thá»§ cÃ´ng

jobs:
  build:
    name: Build iOS IPA
    runs-on: macos-latest

    defaults:
      run:
        working-directory: ./ipa

    steps:
      - name: ğŸ— Check out repository
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
          # TÃ¨o Ä‘Ã£ xÃ³a dÃ²ng cache á»Ÿ Ä‘Ã¢y Ä‘á»ƒ Ä‘áº£m báº£o khÃ´ng dÃ­nh lá»—i Cache Service 400
          
      - name: âš™ï¸ Setup EAS CLI
        uses: expo/expo-github-action@v8
        with:
          eas-version: latest
          token: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ§¹ Clean Cache & Install dependencies
        # TÃ¨o thÃªm bÆ°á»›c clean cache Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t vÃ  cÃ i má»›i hoÃ n toÃ n
        run: |
          npm cache clean --force
          npm install --legacy-peer-deps

      - name: ğŸš€ Build IPA
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
          NPM_CONFIG_LEGACY_PEER_DEPS: "true"
        # TÃ¨o thÃªm tham sá»‘ --clear-cache cho EAS luÃ´n cho cháº¯c
        run: eas build --platform ios --profile preview --local --non-interactive --output app.ipa --clear-cache

      - name: ğŸ“¤ Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ios-ipa
          path: ipa/app.ipa