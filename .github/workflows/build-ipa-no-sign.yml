name: Build IPA No Sign

on:
  workflow_dispatch: # Cho phÃ©p cháº¡y thá»§ cÃ´ng

jobs:
  build:
    name: Build iOS IPA
    runs-on: macos-latest

    # Chá»‰ Ä‘á»‹nh thÆ° má»¥c lÃ m viá»‡c máº·c Ä‘á»‹nh lÃ  'ipa'
    defaults:
      run:
        working-directory: ./ipa

    steps:
      - name: ğŸ— Check out repository
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
          # KhÃ´ng dÃ¹ng cache Ä‘á»ƒ trÃ¡nh lá»—i lock file

      - name: âš™ï¸ Setup EAS CLI
        uses: expo/expo-github-action@v8
        with:
          eas-version: latest
          token: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“¦ Install dependencies
        run: npm install --legacy-peer-deps

      - name: ğŸš€ Build IPA
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
          # [CHIÃŠU CUá»I á» ÄÃ‚Y] Ã‰p buá»™c EAS dÃ¹ng legacy-peer-deps khi nÃ³ tá»± cháº¡y npm ci
          NPM_CONFIG_LEGACY_PEER_DEPS: "true"
        run: eas build --platform ios --profile preview --local --non-interactive --output app.ipa

      - name: ğŸ“¤ Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ios-ipa
          # File káº¿t quáº£ náº±m trong thÆ° má»¥c ipa
          path: ipa/app.ipa